{
  "timestamp": "2025-08-05T09:27:17.336051",
  "test_runs": {
    "Infrastructure Health Check": {
      "name": "Infrastructure Health Check",
      "script": "tests/test_infrastructure_health.py",
      "start_time": "2025-08-05T09:27:17.336064",
      "status": "failed",
      "duration_seconds": 12.42,
      "output": "\ud83d\ude80 Starting Infrastructure Health Verification...\n============================================================\n\n\ud83d\udd0d Checking ALB Health Endpoints...\n  Checking auth_alb_root: https://auth.hokus.ai/\n    \u274c Status: unhealthy (Code: 502, Time: 137.99ms)\n  Checking auth_alb_health: https://auth.hokus.ai/health\n    \u274c Status: unhealthy (Code: 502, Time: 109.2ms)\n  Checking registry_alb_root: https://registry.hokus.ai/\n    \u274c Status: unhealthy (Code: 401, Time: 134.55ms)\n  Checking registry_alb_health: https://registry.hokus.ai/health\n    \u274c Status: unhealthy (Code: 200, Time: 127.08ms)\n  Checking api_alb_health: https://api.hokus.ai/health\n    \u274c Status: unhealthy (Code: 404, Time: 149.88ms)\n\n\ud83d\udd0d Checking ECS Services...\n  Checking ECS service: hokusai-auth-development\n    \u2705 Running: 1/1 tasks\n  Checking ECS service: hokusai-api-development\n    \u2705 Running: 1/1 tasks\n  Checking ECS service: hokusai-mlflow-development\n    \u2705 Running: 1/1 tasks\n\n\ud83d\udd0d Checking MLflow Service...\n  Checking mlflow_health: https://registry.hokus.ai/api/mlflow/health\n    \u2705 Status: healthy (Code: 404, Time: 115.29ms)\n  Checking mlflow_version: https://registry.hokus.ai/api/mlflow/version\n    \u2705 Status: healthy (Code: 404, Time: 114.53ms)\n  Checking mlflow_experiments_api: https://registry.hokus.ai/api/mlflow/api/2.0/mlflow/experiments/search\n    \u274c Status: unhealthy (Code: 404, Time: 108.53ms)\n\n\ud83d\udd0d Checking Redis Connectivity...\n  \u2139\ufe0f  Redis is internal to VPC - will test caching behavior via auth endpoints\n\n\ud83d\udcca Measuring Latency Statistics...\n  Measuring auth_health (5 samples)...\n    \ud83d\udcc8 Avg: 118.59ms, Min: 108.55ms, Max: 128.52ms\n  Measuring registry_health (5 samples)...\n    \ud83d\udcc8 Avg: 122.55ms, Min: 117.36ms, Max: 127.2ms\n  Measuring api_health (5 samples)...\n    \ud83d\udcc8 Avg: 113.86ms, Min: 108.7ms, Max: 118.76ms\n\n============================================================\n\ud83d\udccb INFRASTRUCTURE HEALTH CHECK REPORT\n============================================================\n\n\ud83d\udcc5 Timestamp: 2025-08-05T09:27:17.439911\n\n\ud83d\udcca Summary:\n  Total Checks: 11\n  \u2705 Passed: 5\n  \u274c Failed: 6\n  \u26a0\ufe0f  Warnings: 0\n  \ud83c\udfe5 Health Score: 45.5%\n\n\ud83d\udcbe Detailed report saved to: infrastructure_health_report.json\n\n\ud83d\udd27 Recommendations:\n  - MLflow health endpoints return 404. Consider adding proper health checks.\n\n\u2705 Health check completed!\n",
      "error": "",
      "return_code": 1
    },
    "Authentication Tests": {
      "name": "Authentication Tests",
      "script": "tests/test_authentication.py",
      "start_time": "2025-08-05T09:27:30.763812",
      "status": "failed",
      "duration_seconds": 6.75,
      "output": "\ud83d\ude80 Starting Authentication Tests...\n\ud83d\udd11 Using API key: hk_live_ch...cOWL\n============================================================\n\n\ud83d\udd10 Testing Bearer Token Authentication...\n  Testing valid Bearer token format...\n    \u274c Unexpected response: 404\n  Testing invalid Bearer token format...\n    \u274c missing_bearer: Unexpectedly accepted (status: 404)\n    \u274c lowercase_bearer: Unexpectedly accepted (status: 404)\n    \u274c no_space: Unexpectedly accepted (status: 404)\n    \u274c extra_space: Unexpectedly accepted (status: 404)\n\n\ud83d\udd11 Testing X-API-Key Header Authentication...\n  Testing valid X-API-Key header...\n    \u274c Unexpected response: 404\n  Testing header case sensitivity...\n    \u274c lowercase: Header rejected (status: 404)\n    \u274c mixed_case: Header rejected (status: 404)\n    \u274c uppercase: Header rejected (status: 404)\n\n\ud83d\udd17 Testing Auth Service Integration...\n  Testing API key validation...\n    \u26a0\ufe0f  Auth service health check returned: 502\n    \u274c API key rejected as unauthorized\n\n\u274c Testing Invalid API Key Handling...\n  Testing malformed_short...\n    \u274c Unexpected response: 404\n  Testing malformed_no_prefix...\n    \u274c Unexpected response: 404\n  Testing empty_key...\n    \u274c Unexpected response: 404\n  Testing null_string...\n    \u274c Unexpected response: 404\n  Testing invalid_prefix...\n    \u274c Unexpected response: 404\n  Testing expired_format...\n    \u274c Unexpected response: 404\n\n\u23f0 Testing Auth Cache Behavior...\n  Making initial authenticated request...\n    First request: 404 in 121.64ms\n  Waiting 2 seconds then testing cached request...\n    Cached request: 404 in 113.34ms\n    \u26a0\ufe0f  Cache behavior unclear (similar response times)\n\n\ud83d\udea6 Testing Rate Limiting...\n  Making 20 rapid requests...\n    \u2705 No rate limiting triggered in 20 requests\n\n============================================================\n\ud83d\udccb AUTHENTICATION TEST REPORT\n============================================================\n\n\ud83d\udcc5 Timestamp: 2025-08-05T09:27:30.891166\n\ud83d\udd11 API Key: hk_live_ch...cOWL\n\n\ud83d\udcca Summary:\n  Total Tests: 20\n  \u2705 Passed: 1\n  \u274c Failed: 19\n  \ud83d\udcc8 Success Rate: 5.0%\n\n\ud83d\udcbe Detailed report saved to: authentication_test_report.json\n\n\ud83d\udd0d Key Findings:\n  \u274c Bearer token authentication may have issues\n  \u274c X-API-Key header authentication may have issues\n  \u274c Auth service integration needs attention\n  \u26a0\ufe0f  Auth caching behavior is unclear\n\n\u2705 Authentication testing completed!\n",
      "error": "",
      "return_code": 1
    },
    "Model Registration Flow": {
      "name": "Model Registration Flow",
      "script": "tests/test_model_registration_flow.py",
      "start_time": "2025-08-05T09:27:38.520489",
      "status": "failed",
      "duration_seconds": 3.36,
      "output": "\ud83d\ude80 Starting Model Registration Workflow Test...\n\ud83d\udd11 Using API key: hk_live_ch...cOWL\n============================================================\n\n\ud83e\udd16 Creating Sample Model...\n  \u2705 Model created successfully\n  \ud83d\udcca Metrics: Accuracy=0.870, F1=0.867\n\n\ud83e\uddea Testing Experiment Creation...\n  \u274c Failed to create experiment: 404\n     Response: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n\n\ud83d\udcdd Testing Model Logging...\n  \u274c Failed to create run: 404\n\n\ud83d\udce6 Testing Model Registration...\n  \u274c Failed to register model: 404\n     Response: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n\n============================================================\n\ud83d\udccb MODEL REGISTRATION TEST REPORT\n============================================================\n\n\ud83d\udcc5 Timestamp: 2025-08-05T09:27:41.235280\n\ud83d\udd11 API Key: hk_live_ch...cOWL\n\n\ud83d\udcca Summary:\n  Total Stages: 4\n  \u2705 Passed: 1\n  \u274c Failed: 3\n  \u26a0\ufe0f  Warnings: 0\n  \ud83d\udcc8 Success Rate: 25.0%\n\n\ud83d\udcdd Stage Results:\n  \u2705 model_creation\n  \u274c experiment_creation: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n  \u274c model_logging: Failed to create run: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n  \u274c model_registration: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n",
      "error": "Traceback (most recent call last):\n  File \"/Users/timothyogilvie/Dropbox/Hokusai/hokusai-data-pipeline/tests/test_model_registration_flow.py\", line 622, in <module>\n    results = tester.run_full_workflow()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/timothyogilvie/Dropbox/Hokusai/hokusai-data-pipeline/tests/test_model_registration_flow.py\", line 604, in run_full_workflow\n    self.generate_report()\n  File \"/Users/timothyogilvie/Dropbox/Hokusai/hokusai-data-pipeline/tests/test_model_registration_flow.py\", line 508, in generate_report\n    json.dump(self.results, f, indent=2)\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/__init__.py\", line 179, in dump\n    for chunk in iterable:\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 432, in _iterencode\n    yield from _iterencode_dict(o, _current_indent_level)\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 406, in _iterencode_dict\n    yield from chunks\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 406, in _iterencode_dict\n    yield from chunks\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 406, in _iterencode_dict\n    yield from chunks\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 439, in _iterencode\n    o = _default(o)\n        ^^^^^^^^^^^\n  File \"/Users/timothyogilvie/.pyenv/versions/3.11.8/lib/python3.11/json/encoder.py\", line 180, in default\n    raise TypeError(f'Object of type {o.__class__.__name__} '\nTypeError: Object of type RandomForestClassifier is not JSON serializable\n",
      "return_code": 1
    },
    "Endpoint Availability": {
      "name": "Endpoint Availability",
      "script": "test_endpoint_availability.py",
      "start_time": "2025-08-05T09:27:42.891691",
      "status": "passed",
      "duration_seconds": 1.86,
      "output": "Testing Hokusai API endpoints at https://registry.hokus.ai\nTime: 2025-08-05T09:27:42.978338\n================================================================================\n\n### Testing MLflow Endpoints ###\n\nTesting: MLflow Experiments Search\n  GET https://registry.hokus.ai/api/mlflow/api/2.0/mlflow/experiments/search\n  Status: 404\n  Response: HTML 404 page (endpoint not found)\n\nTesting: MLflow Create Run\n  POST https://registry.hokus.ai/api/mlflow/api/2.0/mlflow/runs/create\n  Status: 404\n  Response: HTML 404 page (endpoint not found)\n\nTesting: MLflow Create Model Version\n  POST https://registry.hokus.ai/api/mlflow/api/2.0/mlflow/model-versions/create\n  Status: 404\n  Response: HTML 404 page (endpoint not found)\n\nTesting: MLflow Get Experiment by Name\n  GET https://registry.hokus.ai/api/mlflow/api/2.0/mlflow/experiments/get-by-name?experiment_name=Default\n  Status: 404\n  Response: HTML 404 page (endpoint not found)\n\n### Testing Direct API Endpoints ###\n\nTesting: Direct Model Registration\n  POST https://registry.hokus.ai/api/models/register\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\nTesting: List Models\n  GET https://registry.hokus.ai/api/models\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\n### Testing Health Endpoints ###\n\nTesting: MLflow Health Check\n  GET https://registry.hokus.ai/api/health/mlflow\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\nTesting: MLflow Detailed Health Check\n  GET https://registry.hokus.ai/api/health/mlflow/detailed\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\nTesting: General Health Check\n  GET https://registry.hokus.ai/api/health\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\n### Testing Alternative URL Patterns ###\n\nTesting: MLflow without /api prefix\n  GET https://registry.hokus.ai/mlflow/api/2.0/mlflow/experiments/search\n  Status: 404\n  Response: Not Found...\n\nTesting: MLflow with single /api prefix\n  GET https://registry.hokus.ai/api/2.0/mlflow/experiments/search\n  Status: 401\n  Response: {\n  \"detail\": \"Authentication service error\"\n}...\n\n================================================================================\nSUMMARY\n================================================================================\n\nAvailable endpoints: 6\n  \u2713 /api/models/register (401)\n  \u2713 /api/models (401)\n  \u2713 /api/health/mlflow (401)\n  \u2713 /api/health/mlflow/detailed (401)\n  \u2713 /api/health (401)\n  \u2713 /api/2.0/mlflow/experiments/search (401)\n\nUnavailable endpoints: 5\n  \u2717 /api/mlflow/api/2.0/mlflow/experiments/search (404)\n  \u2717 /api/mlflow/api/2.0/mlflow/runs/create (404)\n  \u2717 /api/mlflow/api/2.0/mlflow/model-versions/create (404)\n  \u2717 /api/mlflow/api/2.0/mlflow/experiments/get-by-name?experiment_name=Default (404)\n  \u2717 /mlflow/api/2.0/mlflow/experiments/search (404)\n\nDetailed report saved to: endpoint_availability_report.json\n",
      "error": "",
      "return_code": 0
    },
    "MLflow Routing Test": {
      "name": "MLflow Routing Test",
      "script": "scripts/test_mlflow_routing.py",
      "start_time": "2025-08-05T09:27:45.753179",
      "status": "failed",
      "duration_seconds": 0.19,
      "output": "\n\ud83e\uddea Testing MLflow Routing - 2025-08-05 09:27:45.862101\nAPI URL: http://localhost:8000\nDebug Mode: true\n------------------------------------------------------------\n\u274c FAIL MLflow Health Check: Health check failed with status 404\n   Details: {\n  \"status_code\": 404,\n  \"response\": \"{\\\"detail\\\":\\\"Not Found\\\"}\"\n}\n\u274c FAIL Experiment Search API: Both routes working: /mlflow (404) and /api/mlflow (404)\n   Details: {\n  \"/mlflow_status\": 404,\n  \"/api/mlflow_status\": 404,\n  \"response_sample\": null\n}\n\u274c FAIL Model Registry API: Model registry API status: 404\n   Details: {\n  \"status_code\": 404,\n  \"has_models\": null\n}\n\u2705 PASS Artifact Endpoints: Artifact endpoint accessible: status 404\n\u274c FAIL Create Experiment: Failed to create experiment: 404\n   Details: {\n  \"status_code\": 404,\n  \"response\": \"{\\\"detail\\\":\\\"Not Found\\\"}\"\n}\n------------------------------------------------------------\n\n\ud83d\udcca Test Summary: 1/5 tests passed\n\u274c Some tests failed. Check the logs above for details.\n\nFailed tests:\n  - MLflow Health Check: Health check failed with status 404\n  - Experiment Search API: Both routes working: /mlflow (404) and /api/mlflow (404)\n  - Model Registry API: Model registry API status: 404\n  - Create Experiment: Failed to create experiment: 404\n",
      "error": "",
      "return_code": 1
    },
    "Health Endpoints Test": {
      "name": "Health Endpoints Test",
      "script": "scripts/test_health_endpoints.py",
      "start_time": "2025-08-05T09:27:46.944353",
      "status": "failed",
      "duration_seconds": 0.15,
      "output": "\n\ud83c\udfe5 Health Check Endpoint Tests - 2025-08-05 09:27:47.052224\nAPI URL: http://localhost:8000\n------------------------------------------------------------\n\n\ud83d\udc97 Testing Main API Health Check\n============================================================\nStatus Code: 200\nStatus: healthy\nTimestamp: 2025-08-05T13:27:47.064554+00:00\n\n\ud83c\udfe5 Testing MLflow Health Check Endpoint\n============================================================\nStatus Code: 404\n\u274c Health check failed with status 404\nResponse: {\"detail\":\"Not Found\"}\n\n\ud83d\udd0d Testing Detailed MLflow Health Check\n============================================================\nStatus Code: 404\n\u274c Detailed health check failed with status 404\n\n============================================================\n\ud83d\udcca Test Summary:\n  \u2705 API Health: PASS\n  \u274c MLflow Health: FAIL\n  \u274c MLflow Detailed Health: FAIL\n\nTotal: 1/3 tests passed\n\u274c Some health check endpoints failed.\n",
      "error": "",
      "return_code": 1
    },
    "Auth Registration Test": {
      "name": "Auth Registration Test",
      "script": "test_auth_registration.py",
      "start_time": "2025-08-05T09:27:48.097403",
      "status": "passed",
      "duration_seconds": 2.02,
      "output": "Testing Model Registration with Authentication\nTime: 2025-08-05T09:27:49.480824\nTracking URI: https://registry.hokus.ai/api/mlflow\n================================================================================\n\n1. Creating test model...\n   Model accuracy: 0.990\n\n2. Testing experiment access...\n   \u274c Error accessing experiments: API request to endpoint /api/2.0/mlflow/experiments/search failed with error code 404 != 200. Response body: '<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n'\n\n3. Creating MLflow run...\n   \u274c Error creating run: API request to endpoint /api/2.0/mlflow/runs/create failed with error code 404 != 200. Response body: '<!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n'\n\n4. Testing direct API access...\n   Experiments endpoint: 404\n   \u274c Error: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n\n\n================================================================================\nAUTHENTICATION FINDINGS\n================================================================================\n\nThe issue appears to be with MLflow client authentication:\n\n1. The Hokusai API requires Bearer token authentication\n2. MLflow client may not be passing the auth headers correctly\n3. Direct API calls with proper headers work fine\n\nThe third-party user needs to:\n1. Use the correct tracking URI: https://registry.hokus.ai/api/mlflow\n2. Configure authentication properly (may require custom MLflow plugin)\n3. Or use the Hokusai SDK which handles auth automatically\n\n",
      "error": "",
      "return_code": 0
    },
    "Real Registration Test": {
      "name": "Real Registration Test",
      "script": "test_real_registration.py",
      "start_time": "2025-08-05T09:27:51.127664",
      "status": "failed",
      "duration_seconds": 2.29,
      "output": "======================================================================\nREAL THIRD-PARTY MODEL REGISTRATION TEST\n======================================================================\nTimestamp: 2025-08-05T09:27:52.232989\n\n\u2713 API Key: hk_live_ch...cOWL\n\n\ud83d\udd0d Testing Proxy Endpoints...\n  Proxy health check: 404\n  Response: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>\n\n  MLflow API via proxy: 404\n  Response: <!doctype html>\n<html lang=en>\n<title>404 Not Found</title>\n<h1>Not Found</h1>\n<p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try agai\n\n\u274c Proxy endpoints not working. Checking alternatives...\n\n\ud83d\udd0d Testing Direct MLflow Access...\n  Direct MLflow: 404\n  \u2139\ufe0f  Direct MLflow requires authentication\n\n\ud83d\udd27 Attempting workaround: Direct MLflow with API key as token...\n\n\ud83d\udce1 Testing MLflow Client Connection...\n\u274c MLflow client failed: API request to endpoint /api/2.0/mlflow/experiments/search failed with error code 404 != 200. Response body: 'Not Found'\n\n\ud83d\udd27 Trying fallback: Hokusai SDK...\n\u2713 Using Hokusai SDK as fallback\n\n\ud83d\udce6 Using Hokusai SDK for registration...\n\u274c SDK registration failed: Model parameter is required\n\n======================================================================\n\u274c TEST FAILED - Bearer token authentication not working\n\nPossible issues:\n1. The /api/mlflow proxy endpoint is not deployed\n2. The proxy is not properly forwarding Bearer tokens\n3. MLflow backend configuration issues\n\nRecommended actions:\n1. Verify proxy deployment: check ALB routing rules\n2. Check API service logs for errors\n3. Test with direct MLflow access as a workaround\n======================================================================\n",
      "error": "MLflow endpoint not found at https://registry.hokus.ai/mlflow: API request to endpoint /api/2.0/mlflow/experiments/search failed with error code 404 != 200. Response body: 'Not Found'\n",
      "return_code": 1
    },
    "MLflow Proxy Integration": {
      "name": "MLflow Proxy Integration",
      "script": "tests/integration/test_mlflow_proxy_integration.py",
      "start_time": "2025-08-05T09:27:54.425029",
      "status": "failed",
      "duration_seconds": 0.43,
      "output": "",
      "error": "Traceback (most recent call last):\n  File \"/Users/timothyogilvie/Dropbox/Hokusai/hokusai-data-pipeline/tests/integration/test_mlflow_proxy_integration.py\", line 16, in <module>\n    from src.api.main import app\nModuleNotFoundError: No module named 'src'\n",
      "return_code": 1
    }
  },
  "summary": {
    "total_tests": 9,
    "passed": 2,
    "failed": 7,
    "skipped": 0
  }
}